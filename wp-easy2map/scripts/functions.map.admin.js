var easy2map_map_functions=(function(){displayGoogleMap=function(){var e=jQuery.xml2json($mapSettings.Settings);var h=e.lattitude;var d=e.longitude;var a=parseInt(e.zoom);if($map!=null){h=$map.getCenter().lat();d=$map.getCenter().lng();a=$map.getZoom()}var b=retrieveMapOptions(h,d,a);$map=new google.maps.Map(document.getElementById("divMap"),b);$overlay=new google.maps.OverlayView();$overlay.draw=function(){};$overlay.setMap($map);if(b.trafficlayer){var c=new google.maps.TrafficLayer();c.setMap($map)}if(b.transitlayer){var g=new google.maps.TransitLayer();g.setMap($map)}if(b.bicyclelayer){var f=new google.maps.BicyclingLayer();f.setMap($map)}};normaliseCSSElement=function(a){a=replaceAll(a,"_"," ");a=a.toLowerCase().replace(/\b[a-z]/g,function(b){return b.toUpperCase()});return a};refreshExampleMap=function(b){var a=parseInt(jQuery("#MapTemplateName").val());for(var c=0;c<$arrTemplates.length;c++){var d=$arrTemplates[c];if(parseInt(d.ID)==a){jQuery("#divPreview").html(replaceAll(d.TemplateHTML,"[siteurl]",$pluginsURL));if(parseInt(d.StyleParentOnly)==0){jQuery("[id ^= styleElement]").each(function(){jQuery("#divMap").css(replaceAll(jQuery(this).attr("item"),"_","-"),jQuery(this).attr("value"))})}else{jQuery("[id ^= styleElement]").each(function(){if(jQuery(this).attr("item")=="height"){jQuery("#divMap").height("200px")}jQuery("#divMapParent").css(replaceAll(jQuery(this).attr("item"),"_","-"),jQuery(this).attr("value"))});jQuery("#divMap").height(jQuery("#divMapParent").height());jQuery("#easy2mapIimgShadow").width(jQuery("#divMapParent").width());jQuery("#easy2mapIimgShadow").width(jQuery("#divMapParent").width());jQuery("#easy2mapIimgShadow").css("marginLeft",jQuery("#divMapParent").css("marginLeft"));jQuery("#easy2mapIimgShadow").css("marginRight",jQuery("#divMapParent").css("marginRight"))}}}if(!!b){easy2map_map_functions.saveMap(false,false)}displayGoogleMap();google.maps.event.addDomListener(window,"load",easy2map_mappin_functions.retrieveMapPoints())};retrieveMapCSS=function(){var b=[];jQuery("[id ^= styleElement]").each(function(){var c=replaceAll(jQuery(this).attr("item"),"_","-");b[c]=jQuery(this).attr("value")});var a={formatOutput:true,rootTagName:"settings"};return jQuery.json2xml(b,a)};retrieveMapOptions=function(h,f,b){var e=google.maps.MapTypeId.ROADMAP;var g=google.maps.MapTypeControlStyle.DEFAULT;var d=google.maps.ControlPosition.TOP_LEFT;var a=new google.maps.LatLng(h,f);var c={zoom:b,center:a,mapTypeId:e,mapTypeControl:false,clusterpins:false,trafficlayer:false,transitlayer:false,bicyclelayer:false,polyline_strokecolor:"000000",polyline_opacity:"1.0",polyline_strokeweight:"1",mapTypeControlOptions:{style:g,position:d},zoomControl:true,navigationControl:true,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_TOP},scaleControl:false,scaleControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},streetViewControl:true,panControl:false,draggable:true};return c};retrieveMapTemplates=function(b,a){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:b,action:"retrieve_map_templates"},success:function(d){$arrTemplates=d;for(var c=0;c<d.length;c++){jQuery("#MapTemplateName").append("<option value='"+d[c].ID+"'>"+d[c].TemplateName+"</option>")}jQuery("#MapTemplateName").val(a);if(jQuery("#MapTemplateName").val()==null){jQuery("#MapTemplateName").val(d[0].ID)}easy2map_map_functions.changeMapTemplate()},error:function(c,e,d){alert(d)}})};return{changeElementValue:function(a){var b=jQuery("#styleElement"+a).attr("item");var c=replaceAll(replaceAll(jQuery("#styleElement"+a).attr("value"),"px",""),"#","");$styleElementIndex=a;jQuery("div[id ^= div_edit_]").hide();switch(b){case"border_style":jQuery("#tdheading_style").html("Border Style");jQuery("#div_edit_style").modal();jQuery("#txtDefaultValue_style").val(c).focus();break;case"border_width":jQuery("#tdheading_pixel").html("Border Width");jQuery("#txtDefaultValue_pixel").find("option").remove();for(var a=parseInt(0);a<=parseInt(50);a++){jQuery("#txtDefaultValue_pixel").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_pixel").modal();jQuery("#txtDefaultValue_pixel").val(c).focus();break;case"width":if(c.indexOf("%")!=-1){jQuery("#tdheading_percentage").html("Width");jQuery("#txtDefaultValue_percentage").find("option").remove();for(var a=parseInt(1);a<=parseInt(110);a++){jQuery("#txtDefaultValue_percentage").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_percentage").modal();jQuery("#txtDefaultValue_percentage").val(replaceAll(c,"%","")).focus()}else{jQuery("#tdheading_pixel").html("Width");jQuery("#div_edit_pixel").modal();jQuery("#txtDefaultValue_pixel").val(c).focus()}break;case"height":jQuery("#tdheading_pixel").html("Height");jQuery("#txtDefaultValue_pixel").find("option").remove();for(var a=parseInt(10);a<=parseInt(2000);a++){jQuery("#txtDefaultValue_pixel").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_pixel").modal();jQuery("#txtDefaultValue_pixel").val(c).focus();break;case"margin_bottom":jQuery("#tdheading_margin").html("Bottom Margin");jQuery("#txtDefaultValue_margin").find("option").remove();jQuery("#txtDefaultValue_margin").append('<option value="auto">auto</option>');for(var a=parseInt(0);a<=parseInt(500);a++){jQuery("#txtDefaultValue_margin").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_margin").modal();jQuery("#txtDefaultValue_margin").val(c).focus();break;case"margin_top":jQuery("#tdheading_margin").html("Top Margin");jQuery("#txtDefaultValue_margin").find("option").remove();jQuery("#txtDefaultValue_margin").append('<option value="auto">auto</option>');for(var a=parseInt(0);a<=parseInt(500);a++){jQuery("#txtDefaultValue_margin").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_margin").modal();jQuery("#txtDefaultValue_margin").val(c).focus();break;case"margin_left":jQuery("#tdheading_margin").html("Left Margin");jQuery("#txtDefaultValue_margin").find("option").remove();jQuery("#txtDefaultValue_margin").append('<option value="auto">auto</option>');for(var a=parseInt(0);a<=parseInt(500);a++){jQuery("#txtDefaultValue_margin").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_margin").modal();jQuery("#txtDefaultValue_margin").val(c).focus();break;case"margin_right":jQuery("#tdheading_margin").html("Right Margin");jQuery("#txtDefaultValue_margin").find("option").remove();jQuery("#txtDefaultValue_margin").append('<option value="auto">auto</option>');for(var a=parseInt(0);a<=parseInt(500);a++){jQuery("#txtDefaultValue_margin").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_margin").modal();jQuery("#txtDefaultValue_margin").val(c).focus();break;case"border_radius":jQuery("#tdheading_pixel").html("Border Radius");jQuery("#txtDefaultValue_pixel").find("option").remove();for(var a=parseInt(0);a<=parseInt(500);a++){jQuery("#txtDefaultValue_pixel").append('<option value="'+a+'">'+a+"</option>")}jQuery("#div_edit_pixel").modal();jQuery("#txtDefaultValue_pixel").val(c).focus();break;case"border_color":jQuery("#tdheading_color").html("Border Color");jQuery("#div_edit_color").modal();jQuery("#txtDefaultValue_color").val(c).focus();break;case"background_color":jQuery("#tdheading_color").html("Background Color");jQuery("#div_edit_color").modal();jQuery("#txtDefaultValue_color").val(c).focus();break}},changeMapTemplate:function(){var c=jQuery("#MapTemplateName").val();jQuery("#divPreview").html("");for(var e=0;e<$arrTemplates.length;e++){var g=$arrTemplates[e];if(parseInt(g.ID)==c){jQuery("#MapTemplateExampleImg").attr("src",$pluginsURL+g.ExampleImage);var d=jQuery.xml2json(g.CSSValues);jQuery("#MapTemplateCSS").html("");var b=0;var f="",a="";for(var h in d){if(h==="width"){f=d[h]}if(h==="height"){a=d[h]}jQuery("#MapTemplateCSS").append('<div class="cssStyleEditorParent"><a id="styleElement'+b+'" class="cssEdit" href="javascript:easy2map_map_functions.changeElementValue('+b+');" item="'+h+'" value="'+d[h]+'">'+normaliseCSSElement(h)+" ("+d[h]+")</a></div>");b+=1}jQuery("#mapSize").html("");jQuery("#mapSize").append("<option value='640px,480px'>640px x 480px</option>");jQuery("#mapSize").append("<option value='425px,350px'>425px x 350px</option>");jQuery("#mapSize").append("<option value='300px,300px'>300px x 300px</option>");jQuery("#mapSize").append("<option value='custom'>Set Custom Size</option>");jQuery("#mapSize").val(f+","+a).attr("selected","selected");if(jQuery("#mapSize option:selected").val()!=f+","+a){jQuery("#mapSize option:eq("+parseInt(jQuery("#mapSize option").length-2)+")").after("<option selected='selected' value='"+f+","+a+"'>"+f+" x "+a+"</option>")}}}refreshExampleMap(true)},setCustomMapSize:function(){if(isNaN(document.getElementById("txtCustomWidthValue").value)){return}if(isNaN(document.getElementById("txtCustomHeightValue").value)){return}if(parseInt(document.getElementById("txtCustomWidthValue").value)<0){return}if(parseInt(document.getElementById("txtCustomHeightValue").value)<0){return}var b=jQuery("#txtCustomWidthValue").val()+jQuery("#mapWidthDimension").val();var a=jQuery("#txtCustomHeightValue").val()+"px";easy2map_map_functions.changeMapSize(b+","+a)},changeMapSize:function(b){if(b=="custom"){jQuery("[id ^= styleElement]").each(function(){if(jQuery(this).attr("item")==="width"){var c=jQuery(this).attr("value");if(c.indexOf("px")>0){jQuery("#mapWidthDimension").val("px")}else{jQuery("#mapWidthDimension").val("%")}jQuery("#txtCustomWidthValue").val(parseInt(c))}if(jQuery(this).attr("item")==="height"){jQuery("#txtCustomHeightValue").val(parseInt(jQuery(this).attr("value")))}});jQuery("#div_edit_widthheight").modal();return}var a=b.split(",");if(a.length<2){return}jQuery("[id ^= styleElement]").each(function(){if(jQuery(this).attr("item")==="width"){jQuery(this).attr("value",a[0]);jQuery(this).html("Width ("+a[0]+")")}if(jQuery(this).attr("item")==="height"){jQuery(this).attr("value",a[1]);jQuery(this).html("Height ("+a[1]+")")}});jQuery("#mapSize").val(a[0]+","+a[1]).attr("selected","selected");if(jQuery("#mapSize option:selected").val()!=a[0]+","+a[1]){jQuery("#mapSize option:eq("+parseInt(jQuery("#mapSize option").length-2)+")").after("<option selected='selected' value='"+a[0]+","+a[1]+"'>"+a[0]+" x "+a[1]+"</option>")}refreshExampleMap(true)},retrieveMapSettings:function(a){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:a,action:"retrieve_map_settings"},success:function(b){$mapSettings=b;jQuery("#draggable").attr("src",$mapSettings.DefaultPinImage);if($mapSettings.MapName){jQuery("#mapName").val($mapSettings.MapName);jQuery("#mapName2").html($mapSettings.MapName)}else{jQuery("#mapName2").html("Untitled Map")}jQuery("#mapEditPencil").show();retrieveMapTemplates(a,$mapSettings.TemplateID)},error:function(b,d,c){alert(c)}})},saveItemValue:function(){var a=jQuery("#styleElement"+$styleElementIndex).attr("item");var b="";switch(a){case"border_style":b=jQuery("#txtDefaultValue_style").val();jQuery("#div_edit_style").hide();break;case"border_width":b=jQuery("#txtDefaultValue_pixel").val()+"px";jQuery("#div_edit_pixel").hide();break;case"width":if(jQuery("#styleElement"+$styleElementIndex).attr("value").indexOf("%")!=-1){b=jQuery("#txtDefaultValue_percentage").val()+"%";jQuery("#div_edit_percentage").hide()}else{b=jQuery("#txtDefaultValue_pixel").val()+"px";jQuery("#div_edit_pixel").hide()}break;case"height":b=jQuery("#txtDefaultValue_pixel").val()+"px";jQuery("#div_edit_pixel").hide();break;case"margin_top":b=jQuery("#txtDefaultValue_margin").val();if(b!="auto"){b+="px"}jQuery("#div_edit_margin").hide();break;case"margin_bottom":b=jQuery("#txtDefaultValue_margin").val();if(b!="auto"){b+="px"}jQuery("#div_edit_margin").hide();break;case"margin_left":b=jQuery("#txtDefaultValue_margin").val();if(b!="auto"){b+="px"}jQuery("#div_edit_margin").hide();break;case"margin_right":b=jQuery("#txtDefaultValue_margin").val();if(b!="auto"){b+="px"}jQuery("#div_edit_margin").hide();break;case"border_color":b="#"+jQuery("#txtDefaultValue_color").val();jQuery("#tdItemElementValue").css("background-Color","#"+jQuery("#txtDefaultValue_color").val());jQuery("#div_edit_color").hide();break;case"background_color":b="#"+jQuery("#txtDefaultValue_color").val();jQuery("#tdItemElementValue").css("background-Color","#"+jQuery("#txtDefaultValue_color").val());jQuery("#div_edit_color").hide();break;case"z-index":b=jQuery("#txtDefaultValue_pixel").val();jQuery("#div_edit_pixel").hide();break;case"border_radius":b=jQuery("#txtDefaultValue_pixel").val()+"px";jQuery("#div_edit_pixel").hide();break}jQuery("#styleElement"+$styleElementIndex).attr("value",b);jQuery("#styleElement"+$styleElementIndex).html(normaliseCSSElement(a)+" ("+b+")");refreshExampleMap(true)},saveMap:function(f,h){var c=jQuery.xml2json($mapSettings.Settings);var b=c.lattitude;var e=c.longitude;var g=parseInt(c.zoom);if($map!=null){b=$map.getCenter().lat();e=$map.getCenter().lng();g=$map.getZoom()}var a={lattitude:b,longitude:e,zoom:g,mapType:"ROADMAP",backgroundColor:"FFFFFF",draggable:1,clusterpins:0,trafficlayer:0,transitlayer:0,bicyclelayer:0,scrollWheel:0,mapTypeControl:0,panControl:0,rotateControl:0,scaleControl:0,streetViewControl:1,zoomControl:1,mapTypeControl_style:"DROPDOWN_MENU",mapTypeControl_position:"TOP_RIGHT",panControl_position:"TOP_LEFT",rotateControl_position:"TOP_LEFT",scaleControl_position:"TOP_LEFT",streetViewControl_position:"TOP_LEFT",zoomControl_position:"TOP_LEFT",zoomControl_style:"SMALL",polyline_strokecolor:"000000",polyline_opacity:"1.0",polyline_strokeweight:"1"};var i={formatOutput:true,rootTagName:"settings"};jQuery("#divMap").html("");var d=jQuery("#divPreview").html();jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:$mapID,mapName:jQuery("#mapName").val()==""?"Untitled Map":jQuery("#mapName").val(),mapTemplateName:jQuery("#MapTemplateName").val(),action:"save_map",mapSettingsXML:jQuery.json2xml(a,i),mapCSSXML:encodeURIComponent(retrieveMapCSS()),mapHTML:encodeURIComponent(d)},success:function(j){if(f){if(h){jQuery("#txtShortCode").val("[easy2map id="+j+"]");jQuery("#mapShortCode").modal({keyboard:false});jQuery("#mapShortCode").on("shown",function(){document.getElementById("txtShortCode").focus();document.getElementById("txtShortCode").select()})}else{window.location="?page=easy2map&action=viewmaps"}return}$mapID=j;jQuery("#formAddPinIcon").attr("action","?page=easy2map&action=mappinimagesave&map_id="+$mapID)},error:function(j,l,k){alert(k)}})},saveMapName:function(){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:$mapID,mapName:jQuery("#mapName").val()==""?"Untitled Map":jQuery("#mapName").val(),action:"save_map_name"},error:function(a,c,b){alert(b)}})}}})();