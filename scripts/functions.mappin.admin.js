var easy2map_mappin_functions=(function(){var a;clearPinArray=function(){if($pinsArray){for(i in $pinsArray){$pinsArray[i].setMap(null);$pinsArray[i].setAnimation(null)}}if($pinsArray){$pinsArray.length=0}$selectedPin=null};addPinToMap=function(b){this.selectedMapPoint=b;try{var f=decodeURIComponent(this.selectedMapPoint.pinhtml)}catch(d){f=this.selectedMapPoint.pinhtml}var c=new google.maps.Marker({position:new google.maps.LatLng(this.selectedMapPoint.lattitude,this.selectedMapPoint.longitude),draggable:true,map:$map,title:this.selectedMapPoint.title.replace(/\\/gi,""),ID:this.selectedMapPoint.ID,icon:this.selectedMapPoint.icon,settings:this.selectedMapPoint.settings,pinHTML:f});$pinsArray.push(c);google.maps.event.addListener(c,"dragend",function(e){$latlng=e.latLng;showLatLong();updateMapPinLocation(c.ID)});google.maps.event.addListener(c,"click",function(k){if(a){a.close()}var g=c.pinHTML.split("\n");var h="";for(var j=0;j<g.length;j++){if(j>0){h+="<br>"}h+=g[j]}var e='<p id="e2mpopuphook">'+h+"</p>";a=new google.maps.InfoWindow();a.setContent(e);a.open(c.map,c);google.maps.event.addListener(a,"domready",function(){try{var m=jQuery("#e2mpopuphook").parent().parent().parent().siblings();for(var n=0;n<m.length;n++){if(jQuery(m[n]).css("z-index")=="auto"){jQuery(m[n]).css("border-radius","7px")}}}catch(o){}})})};listedMapPin=function(b){this.pinDetails=b};setPinImage=function(b){jQuery("#draggable").attr("src",jQuery(b).attr("src"));jQuery("#mapPinIconList").modal("hide");if($pinsArray){for(i in $pinsArray){if(typeof $pinsArray[i].ID=="undefined"||typeof $selectedPin.ID=="undefined"){continue}if($pinsArray[i].ID==$selectedPin.ID){$pinsArray[i].setIcon(jQuery(b).attr("src"))}}}};showLatLong=function(){jQuery("#latLongParent").show();jQuery("#divLatLong").html("Position of Pin: "+$latlng)};updateMapPinLocation=function(b){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapPointID:b,latLong:$latlng+"",action:"update_map_pin_location"}})};return{addNewMapMarker:function(){jQuery("#AddMarker").hide();jQuery("#SaveMap").hide();jQuery("#tblAddMapMarker").show()},cancelSaveMapPin:function(){jQuery("#pinNameParent").hide();jQuery("#pinDescriptionParent").hide();jQuery("#divAddressSearch").show();jQuery("#btnCancelPin").hide();jQuery("#AddMarker").hide();jQuery("#SaveMap").hide();jQuery("#tblAddMapMarker").hide();jQuery("#address").attr("placeholder","Enter Marker's Address");document.getElementById("mapSize").disabled=false;jQuery("#draganddrop").show();jQuery("#AddEditPinTitle").html("Add New Marker");jQuery("#divDrag").show();jQuery("#divPinAddEditParent").hide();jQuery("#easy2maptab2").removeClass("disabled");jQuery("#pinName").val("");jQuery("#pinDescription").data("wysihtml5").editor.clear();jQuery("#btnDeletePin").hide();jQuery("#btnSavePin").hide();jQuery("#latLongParent").hide();jQuery("#draggable").attr("src",$mapSettings.DefaultPinImage);if($selectedPin){$selectedPin.setAnimation(null)}$selectedPin=null;easy2map_mappin_functions.setIconDraggable();jQuery("td [id ^= imageTd]").removeClass("highlighted");jQuery("td [id ^= nameTd]").removeClass("highlighted");if($pinsArray){for(i in $pinsArray){if($pinsArray[i].ID==0){$pinsArray[i].setMap(null);$pinsArray[i].setAnimation(null);$pinsArray.splice(i,1)}}}jQuery("tr [id ^=divPinInstructions]").show();jQuery("#draganddrop").show();$mapPinID=0},changeMapPinTemplate:function(){var b=parseInt(jQuery("#MapPinTemplateName").val());for(var c=0;c<$arrTemplates.length;c++){var d=$arrTemplates[c];if(parseInt(d.ID)==b){jQuery("#MapTemplateExampleImg").html(d.TemplateHTML)}}},deleteSelectedPoint:function(){if(!confirm("Are you sure you wish to delete this pin? This action is not reversible!")){return}jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{MapPointID:$mapPinID,action:"delete_map_point"},success:function(b){if(b.length>0){alert("D"+b);return}clearPinArray();if($pinsArray){$pinsArray.length=0}easy2map_mappin_functions.retrieveMapPoints()},error:function(b,d,c){if(c.length>0){alert("E"+c)}}})},displayPinItem:function(b){for(var c=0;c<$pinsArray.length;c++){if($pinsArray[c].ID){if(parseInt($pinsArray[c].ID)===b){google.maps.event.trigger($pinsArray[c],"click");return}}}},editPinItem:function(c){var b=$markersArray[c].pinDetails;$latlng=new google.maps.LatLng(b.lattitude,b.longitude);$selectedPin=$pinsArray[c];showLatLong();$selectedPin.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){$selectedPin.setAnimation(null)},1500);jQuery("td [id ^= imageTd]").removeClass("highlighted");jQuery("td [id ^= nameTd]").removeClass("highlighted");jQuery("#imageTd"+c).addClass("highlighted");jQuery("#nameTd"+c).addClass("highlighted");document.getElementById("mapSize").disabled=true;jQuery("#pinNameParent").show();jQuery("#pinDescriptionParent").show();jQuery("#divAddressSearch").show();jQuery("#address").attr("placeholder","Change Marker's Location");jQuery("#AddMarker").hide();jQuery("#SaveMap").hide();jQuery("#tblAddMapMarker").show();jQuery("#draganddrop").hide();jQuery("#btnCancelPin").show();jQuery("#AddEditPinTitle").html("Edit Marker's Details");jQuery("#btnUploadIcon").html("Change Icon");jQuery("#divDrag").hide();jQuery("#divPinAddEditParent").show();jQuery("#easy2maptab2").addClass("disabled");jQuery("#pinName").val(b.title.replace(/\\/gi,""));try{var f=decodeURIComponent(b.pinhtml)}catch(d){f=b.pinhtml}jQuery("#pinDescription").data("wysihtml5").editor.setValue(f);$mapPinID=b.ID;jQuery("#btnDeletePin").show();jQuery("#btnSavePin").show();jQuery("tr [id ^=divPinInstructions]").hide();jQuery("#draggable").attr("src",b.icon);easy2map_mappin_functions.setIconNotDraggable()},hidePreviewPage:function(){jQuery("#divMultipleLocations").fadeOut()},openImagesDirectory:function(b){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapID:$mapID,action:"retrieve_pin_icons"},success:function(f){jQuery("#tblPinImages").find("tr").remove();var c=0;for(var e=0;e<f.length;e++){if(c%6==0){var g=document.createElement("tr");document.getElementById("tblPinImages").appendChild(g)}var d=document.createElement("td");d.align="center";d.style.borderColor="#FFFFFF";d.style.padding="2px";if(f[e]==b){d.style.borderColor="#EBEBEB";d.style.borderWidth="2px";d.style.borderStyle="solid";d.style.borderRadius="3px"}var h=document.createElement("img");h.style.cursor="pointer";h.setAttribute("onClick","easy2map_mappin_functions.setMapPinImage(this)");h.src=f[e];d.appendChild(h);g.appendChild(d);c+=1}jQuery("#mapPinIconList").modal()},error:function(c,e,d){alert("E"+d)}})},placePin:function(c){var b=new google.maps.Marker({position:c,ID:0,draggable:true,bouncy:true,title:"Click on icon to edit details",map:$map,icon:jQuery("#draggable").attr("src")});$latlng=b.position;$pinsArray.push(b);$selectedPin=$pinsArray[$pinsArray.length-1];showLatLong();jQuery("#pinNameParent").show();jQuery("#pinDescriptionParent").show();jQuery("#divAddressSearch").hide();document.getElementById("mapSize").disabled=true;jQuery("#draganddrop").hide();jQuery("#btnCancelPin").show();jQuery("#AddEditPinTitle").html("Set Marker's Details");jQuery("#btnUploadIcon").html("Change Icon");jQuery("#address").attr("placeholder","Change Marker's Location");jQuery("#divDrag").hide();jQuery("#divPinAddEditParent").show();jQuery("tr [id ^=divPinInstructions]").hide();jQuery("#pinName").focus();jQuery("#btnSavePin").show();easy2map_mappin_functions.setIconNotDraggable();google.maps.event.addListener(b,"dragend",function(d){$latlng=d.latLng;showLatLong()});google.maps.event.addListener(b,"click",function(d){$latlng=d.latLng;showLatLong()})},retrieveMapPoints:function(){var b={action:"retrieve_map_points",MapID:$mapID};easy2map_mappin_functions.cancelSaveMapPin();jQuery.ajax({type:"POST",url:ajaxurl,data:b,dataType:"json",success:function(s){jQuery("#tblMapMarkers").show().find("tr").remove();jQuery("#tblEasy2MapPinList").find("tr").remove();jQuery("#ulEasy2MapPinList").find("li").remove();jQuery("#divAddressSearch").show();var h=false;if(typeof s=="undefined"||typeof s=="null"){h=true}if(!s){h=true}if(s.length==0){h=true}if(h){jQuery("#AddMarker").hide();jQuery("#SaveMap").hide();jQuery("#tblAddMapMarker").show();jQuery("#MarkersListHeading").html("");return}else{jQuery("#AddMarker").show();jQuery("#SaveMap").show();jQuery("#tblAddMapMarker").hide();jQuery("#MarkersListHeading").html("<h6>Map Markers</h6>")}if($markersArray){$markersArray.length=0}clearPinArray();for(var n=0;n<s.length;n++){var j=replaceAll(replaceAll(replaceAll(s[n].LatLong," ",""),"(",""),")","").split(",");var g={lattitude:j[0],longitude:j[1],ID:s[n].ID,title:s[n].Title,icon:s[n].ImageURL,settings:s[n].Settings,pinhtml:s[n].MapPinHTML};$markersArray.push(new listedMapPin(g))}for(var u=0;u<$markersArray.length;u++){var y=$markersArray[u].pinDetails;addPinToMap(y);var c=document.createElement("tr");document.getElementById("tblMapMarkers").appendChild(c);var r=document.createElement("td");r.id="imageTd"+u;r.align="center";var p=document.createElement("img");p.style.cursor="pointer";p.setAttribute("onClick","easy2map_mappin_functions.editPinItem("+u+")");p.src=y.icon;r.style.minWidth="30px";r.style.textAlign="center";r.appendChild(p);var C=document.createElement("td");C.id="nameTd"+u;C.innerHTML=y.title.replace(/\\/gi,"");C.style.width="80%";C.style.cursor="pointer";C.setAttribute("onClick","easy2map_mappin_functions.editPinItem("+u+")");var k=document.createElement("td");k.id="editTd"+u;k.style.minWidth="10%";k.style.textAlign="center";var F=document.createElement("a");F.innerText="edit";F.textContent="edit";F.href="#";F.setAttribute("className","smallE2MLink");F.setAttribute("onclick","easy2map_mappin_functions.editPinItem("+u+")");k.appendChild(F);c.appendChild(r);c.appendChild(C);c.appendChild(k);var d=document.getElementById("tblEasy2MapPinList");if(d!==null){var B=document.createElement("tr");var A=document.createElement("tr");var z=document.createElement("tr");var v=document.createElement("td");v.align="center";v.rowSpan="2";v.style.padding="3px";v.style.verticalAlign="top";var x=document.createElement("img");x.src=y.icon;x.style.cursor="pointer";x.setAttribute("onClick","if (typeof easy2map_functions !== 'undefined') { easy2map_functions.displayPinItem("+y.ID+")} else { easy2map_mappin_functions.displayPinItem("+y.ID+")}");v.style.textAlign="center";v.appendChild(x);var E=document.createElement("td");E.innerHTML=y.title.replace(/\\/gi,"");E.style.verticalAlign="top";E.style.fontSize="1.2em";E.style.padding="3px";E.style.fontWeight="bold";E.style.cursor="pointer";E.setAttribute("onClick","if (typeof easy2map_functions !== 'undefined') { easy2map_functions.displayPinItem("+y.ID+")} else { easy2map_mappin_functions.displayPinItem("+y.ID+")}");var o=document.createElement("td");o.style.textAlign="left";o.style.padding="3px";try{var D=decodeURIComponent(y.pinhtml)}catch(w){D=y.pinhtml}o.innerHTML=D;var q=document.createElement("td");q.style.height="10px";d.appendChild(B);B.appendChild(v);B.appendChild(E);d.appendChild(A);A.appendChild(o);d.appendChild(z);z.appendChild(q)}var l=document.getElementById("ulEasy2MapPinList");if(l!==null){var m=document.createElement("li");var f=document.createElement("table");var B=document.createElement("tr");var A=document.createElement("tr");m.style.display="table-cell";m.style.verticalAlign="top";m.style.minWidth="200px";f.cellPadding="2";f.cellSpacing="2";f.className="tblHorizontalPinList";var v=document.createElement("td");v.align="center";v.rowSpan="2";v.style.padding="3px";v.style.paddingLeft="16px";v.style.verticalAlign="top";var x=document.createElement("img");x.src=y.icon;x.style.cursor="pointer";x.setAttribute("onClick","if (typeof easy2map_functions !== 'undefined') { easy2map_functions.displayPinItem("+y.ID+")} else { easy2map_mappin_functions.displayPinItem("+y.ID+")}");v.style.textAlign="center";v.appendChild(x);var E=document.createElement("td");E.innerHTML=y.title.replace(/\\/gi,"");E.style.verticalAlign="top";E.style.padding="3px";E.style.fontWeight="bold";E.style.cursor="pointer";E.setAttribute("onClick","if (typeof easy2map_functions !== 'undefined') { easy2map_functions.displayPinItem("+y.ID+")} else { easy2map_mappin_functions.displayPinItem("+y.ID+")}");var o=document.createElement("td");o.style.textAlign="left";o.style.padding="3px";try{var D=decodeURIComponent(y.pinhtml)}catch(w){D=y.pinhtml}o.innerHTML=D;f.appendChild(B);B.appendChild(v);B.appendChild(E);f.appendChild(A);A.appendChild(o);m.appendChild(f);l.appendChild(m)}}jQuery("#tblMapMarkers").removeClass("table-striped").addClass("table-striped")}})},saveMapPin:function(){var b=jQuery("#pinDescription").val();b=replaceAll(b,"&quot;Arial&quot;","Arial");b=replaceAll(b,"&quot;Times New Roman&quot;","Arial");b=replaceAll(b,"&quot;sans-serif&quot;","sans-serif");b=replaceAll(b,'class="MsoNormal"',"");b=b.replace(/ – /g," - ");b=replaceAll(b,"line-height:","min-height:");if(b.indexOf("<p")!==-1){b=replaceAll(b,"'","&#39;")}b=replaceAll(b,"<p>",'<p style="margin:0; padding:0;">');b=replaceAll(b,'<p style="text-align: left;">','<p style="text-align: left;margin:0; padding:0;">');b=replaceAll(b,'<p style="text-align: right;">','<p style="text-align: left;margin:0; padding:0;">');b=replaceAll(b,'<p style="text-align: center;">','<p style="text-align: left;margin:0; padding:0;">');if(b.indexOf("[endif]")!==-1){b=b.substring(b.lastIndexOf("[endif]")+10)}jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{mapPointID:$mapPinID,action:"save_map_pin",latLong:$latlng+"",icon:jQuery("#draggable").attr("src"),pinTitle:jQuery("#pinName").val(),pinSettingsXML:"",pinHTML:encodeURIComponent(b),mapID:$mapID},success:function(c){easy2map_mappin_functions.retrieveMapPoints();$selectedPin=null},error:function(c,e,d){alert("F"+d)}})},setCurrentPosition:function(d,c){var b=new google.maps.LatLng(d,c);$latlng=b},setMapPinImage:function(b){jQuery.ajax({type:"POST",url:ajaxurl,dataType:"json",data:{MapID:$mapID,PinImage:encodeURIComponent(jQuery(b).attr("src")),action:"save_default_pin_image"},success:function(c){jQuery("#draggable").attr("src",jQuery(b).attr("src"));jQuery("#mapPinIconList").modal("hide");$mapSettings.DefaultPinImage=c;setPinImage(b)},error:function(c,e,d){alert("G"+d)}})},SetPinPosition:function(f,d){var b=new google.maps.LatLng(f,d);$latlng=b;if($selectedPin==null){easy2map_mappin_functions.placePin(b);if($markersArray.length==0){$map.setCenter(b);$map.setZoom(12);var e=jQuery.xml2json($mapSettings.Settings);e.lattitude=f;e.longitude=d;e.zoom=$map.getZoom();var c={formatOutput:true,rootTagName:"settings"};$mapSettings.Settings=jQuery.json2xml(e,c)}}else{$selectedPin.setPosition(b)}setTimeout("jQuery('#address').val('')",1500)},setIconDraggable:function(){jQuery("#draggable").css("cursor","move");jQuery("#draggable").draggable({appendTo:"#bodyTag",scroll:false,helper:"clone",stop:function(j){var h=$map.getBounds();var f=h.getSouthWest();var d=h.getNorthEast();var c=jQuery("#divMap").offset();var b=new google.maps.Point(j.pageX-c.left,j.pageY-c.top+22);var g=$overlay.getProjection().fromContainerPixelToLatLng(b);if(f.lng()>0&&(g.lng()>0&&g.lng()<f.lng())){return}if(f.lng()<0&&(g.lng()<0&&g.lng()<f.lng())){return}if(d.lng()>0&&(g.lng()>0&&g.lng()>d.lng())){return}if(d.lng()<0&&(g.lng()<0&&g.lng()>d.lng())){return}easy2map_mappin_functions.placePin(g)}})},setIconNotDraggable:function(){jQuery("#draggable").css("cursor","default").draggable("destroy")},uploadPinIcon:function(){var b=checkFileExtensionSilent(document.getElementById("pinicon"));if(b!=""){alert("Invalid file, only the following image types are allowed: "+b+". Please upload a different image.");return}document.formAddPinIcon.submit()}}})();